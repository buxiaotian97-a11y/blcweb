<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Black Company Simulator | Home</title>
  
  <link rel="stylesheet" th:href="@{/css/home-back.css}" href="/css/home-back.css">
  <link rel="stylesheet" th:href="@{/css/home-button.css}" href="/css/home-button.css">
  <link rel="stylesheet" th:href="@{/css/button.css}" href="/css/button.css">
  <link rel="stylesheet" th:href="@{/css/font.css}" href="/css/font.css">

</head>
<body>
  <main class="stage" aria-label="ホーム画面">
    <div class="salaryman" aria-hidden="true"></div>
    <div class="scanlines" aria-hidden="true"></div>

    <div class="wrap">

      <section class="home-grid layout-v2" aria-label="ホームUI">

        <!-- 上中央：部署＋名前のプレート -->
        <header class="nameplate font2">
          <div class="dept font2" th:text="${user.department}">営業部</div>
          <div class="uname font2" >石黒　雄三（36）</div>
		  <aside class="level-stack dial-mode">
		  		  <div class="lv font2">Lv.<span th:text="${user.level}">1</span></div>
        </header>
		
		<div class="cta-stack">
		<a class="btn small diagnose-btn font" th:href="@{/mode}" href="/mode">診断する</a>
		<button class="btn-briefcase" style="--label-top:60%; --label-left:40%;">
		  <div class="img-wrap">
		  <img class="fx font" src="/images/clear-bag.png" alt="">
		  <img class="overlay-img" src="/images/lock.png" alt="">
		  <span class="label font">出勤する</span>
		</button>
		</div>
		
		<script>
		  document.querySelectorAll('.btn-briefcase').forEach(btn => {
		    btn.addEventListener('click', () => {
		      btn.classList.remove('flash');
		      void btn.offsetWidth;
		      btn.classList.add('flash');
		      setTimeout(() => btn.classList.remove('flash'), 1100);
		    });
		  });
		</script>

        <!-- 中央：キャラクター -->
        <div class="center-char">
          <div class="char font2">
            <img th:src="@{${user.character} == 'restaurant' ? '/images/restaurant.png' : '/images/sarari-3.png'}" src="/images/sarari-3.png" alt="キャラクター">
          </div>
        </div>

		<!-- 右上ハンバーガー -->
		<details class="hamburger at-tr" aria-label="メニュー">
		  <summary class="hambtn font" aria-label="メニューを開く">
		    <span class="bars" aria-hidden="true"></span>
		  </summary>

		  <!-- ここが“真下に”展開される -->
		  <nav class="list font">
		    <a href="/stats">📊 記録</a>
		    <a href="/profile">🪪 キャラクター詳細</a>
			<a href="/trophy">🏆 称号・アイテム一覧</a>
		    <a href="/settings">⚙️ 設定</a>
		  </nav>
		</details>
		
		<script>
		  document.addEventListener("click", function (e) {
		    const menu = document.querySelector(".hamburger");
		    if (!menu) return;

		    if (menu.contains(e.target)) return;

		    if (menu.hasAttribute("open")) {
		      menu.removeAttribute("open");
		    }
		  });
		</script>
		
      </section>

      <div class="meta font">
        <span>v0.1.0</span>
      </div>
    </div>
  </main>

  <script>
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('pointerdown', e => {
        const rect = btn.getBoundingClientRect();
        btn.style.setProperty('--mx', `${e.clientX - rect.left}px`);
        btn.style.setProperty('--my', `${e.clientY - rect.top}px`);
      });
    });

    const stage = document.querySelector('.stage');
    const strength = 8; 
    let rafId = null;
    function onMove(e){
      const x = (e.clientX / window.innerWidth - 0.5) * strength;
      const y = (e.clientY / window.innerHeight - 0.5) * strength;
      if(rafId) cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(() => {
        stage.style.backgroundPosition = `calc(50% + ${x}px) 80px, center`;
      });
    }
    window.addEventListener('pointermove', onMove);
	
	

  </script>
</body>
</html>
