<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Black Company Simulator | Home</title>
  
  <link rel="stylesheet" th:href="@{/css/home-back.css}" href="/css/home.css">
  <link rel="stylesheet" th:href="@{/css/home-button.css}" href="/css/home.css">

</head>
<body>
  <main class="stage" aria-label="ホーム画面">
    <div class="salaryman" aria-hidden="true"></div>
    <div class="scanlines" aria-hidden="true"></div>

    <div class="wrap">

      <section class="home-grid layout-v2" aria-label="ホームUI">
        <!-- 左上：グラフ（統計） -->
        <div class="corner tl">
          <a class="icon graph" th:href="@{/stats}" href="/stats" aria-label="統計">
            <svg viewBox="0 0 24 24" width="36" height="36" fill="currentColor" aria-hidden="true">
              <rect x="3" y="12" width="4" height="8" rx="1"></rect>
              <rect x="10" y="8" width="4" height="12" rx="1"></rect>
              <rect x="17" y="5" width="4" height="15" rx="1"></rect>
            </svg>
          </a>
        </div>

        <!-- 上中央：部署＋名前のプレート -->
        <header class="nameplate">
          <div class="dept" th:text="${user.department}">営業部</div>
          <div class="uname" th:text="${user.name}">佐藤 健太</div>
        </header>

        <!-- 右上：設定（歯車） -->
        <div class="corner tr">
          <a class="icon gear" th:href="@{/settings}" href="/settings" aria-label="設定">
            <svg viewBox="0 0 24 24" width="36" height="36" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.6 1.6 0 0 0 .3 1.8l.1.1a2 2 0 1 1-2.8 2.8l-.1-.1a1.6 1.6 0 0 0-1.8-.3 1.6 1.6 0 0 0-1 1.5V21a2 2 0 0 1-4 0v-.1a1.6 1.6 0 0 0-1-1.5 1.6 1.6 0 0 0-1.8.3l-.1.1a2 2 0 1 1-2.8-2.8l.1-.1a1.6 1.6 0 0 0 .3-1.8 1.6 1.6 0 0 0-1.5-1H3a2 2 0 0 1 0-4h.1a1.6 1.6 0 0 0 1.5-1 1.6 1.6 0 0 0-.3-1.8l-.1-.1a2 2 0 1 1 2.8-2.8l.1.1a1.6 1.6 0 0 0 1.8.3H9a1.6 1.6 0 0 0 1-1.5V3a2 2 0 0 1 4 0v.1a1.6 1.6 0 0 0 1 1.5 1.6 1.6 0 0 0 1.8-.3l.1-.1a2 2 0 1 1 2.8 2.8l-.1.1a1.6 1.6 0 0 0-.3 1.8v.1a1.6 1.6 0 0 0 1.5 1H21a2 2 0 0 1 0 4h-.1a1.6 1.6 0 0 0-1.5 1z"></path>
            </svg>
          </a>
        </div>

        <!-- 中央：キャラクター -->
        <div class="center-char">
          <div class="char">
            <img th:src="@{${user.character} == 'restaurant' ? '/images/restaurant.png' : '/images/sarari-3.png'}" src="/images/sarari-3.png" alt="キャラクター">
          </div>
        </div>

        <!-- 右：縦レベルゲージ＋診断ボタン -->
        <aside class="level-stack">
          <div class="lv">Lv.<span th:text="${user.level}">1</span></div>
          <div class="level-vert" role="img" aria-label="レベルゲージ">
            <span class="fill" style="--p:35%" th:style="'--p:' + ${user.expPercent} + '%' "></span>
            <span class="ticks" aria-hidden="true"></span>
          </div>
          <a class="btn small" th:href="@{/diagnose}" href="/diagnose">診断する</a>
        </aside>

        <!-- 下中央：出勤する（大ボタン） -->
        <a class="btn primary cta cta-briefcase" th:href="@{/work}" href="/work">出勤する</a>

        <!-- 左下：記録（IDカード風） -->
        <div class="corner bl">
          <a class="icon idcard" th:href="@{/records}" href="/records" aria-label="記録">
            <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <rect x="2" y="5" width="20" height="14" rx="2"></rect>
              <circle cx="8" cy="12" r="2"></circle>
              <path d="M12 10h6M12 14h6"></path>
            </svg>
          </a>
        </div>

        <!-- 右下：称号＋ファイル -->
        <div class="corner br group">
          <a class="icon trophy" th:href="@{/titles}" href="/titles" aria-label="称号">
            <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M8 21h8M12 17v4M6 4h12v3a6 6 0 0 1-6 6 6 6 0 0 1-6-6V4z"></path>
            </svg>
          </a>
          <a class="icon file" th:href="@{/records}" href="/records" aria-label="ファイル">
            <img th:src="@{/images/folder.png}" src="/images/folder.png" alt="ファイル">
          </a>
        </div>
      </section>

      <div class="meta">
        <span>v0.1.0</span>
      </div>
    </div>
  </main>

  <script>
    // ============ ボタンの波紋位置をカーソルに合わせる
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('pointerdown', e => {
        const rect = btn.getBoundingClientRect();
        btn.style.setProperty('--mx', `${e.clientX - rect.left}px`);
        btn.style.setProperty('--my', `${e.clientY - rect.top}px`);
      });
    });

    // ============ わずかなパララックス(背景全体)
    const stage = document.querySelector('.stage');
    const strength = 8; // px
    let rafId = null;
    function onMove(e){
      const x = (e.clientX / window.innerWidth - 0.5) * strength;
      const y = (e.clientY / window.innerHeight - 0.5) * strength;
      if(rafId) cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(() => {
        stage.style.backgroundPosition = `calc(50% + ${x}px) 80px, center`;
      });
    }
    window.addEventListener('pointermove', onMove);

    // ============ 実装時のナビゲーション置き換えフック
    document.getElementById('startBtn').addEventListener('click', (e) => {
      // TODO: ここをフロントルーター遷移 or 通常のリンク先に置換
      // 例) location.href = '/play';
      // 今はデモなのでアンカーのまま
    });
      // レベルゲージ初期化（data-p を width に反映してアニメ開始）
    document.querySelectorAll('.levelbar .bar span').forEach(sp =>{
      const p = sp.getAttribute('data-p') || 0;
      sp.style.setProperty('--p', p + '%');
      sp.classList.add('gain');
    });
  </script>
</body>
</html>
