<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Black Company Simulator | Home</title>
  
  <link rel="stylesheet" th:href="@{/css/home-back.css}" href="/css/home-back.css">
  <link rel="stylesheet" th:href="@{/css/home-button.css}" href="/css/home-button.css">

</head>
<body>
  <main class="stage" aria-label="ホーム画面">
    <div class="salaryman" aria-hidden="true"></div>
    <div class="scanlines" aria-hidden="true"></div>

    <div class="wrap">

      <section class="home-grid layout-v2" aria-label="ホームUI">

        <!-- 上中央：部署＋名前のプレート -->
        <header class="nameplate">
          <div class="dept" th:text="${user.department}">営業部</div>
          <div class="uname" >石黒　雄三（36）</div>
        </header>
		
		<!-- 下中央：出勤する（大ボタン） -->
		<button class="btn-briefcase" style="--label-top:72%; --label-left:50%;">
		  <span class="label">出勤する</span>
		</button>

        <!-- 中央：キャラクター -->
        <div class="center-char">
          <div class="char">
            <img th:src="@{${user.character} == 'restaurant' ? '/images/restaurant.png' : '/images/sarari-3.png'}" src="/images/sarari-3.png" alt="キャラクター">
          </div>
        </div>

		<aside class="level-stack dial-mode">
		  <div class="lv">Lv.<span th:text="${user.level}">1</span></div>

		  <!-- 半円メーター（--p: 0〜100） -->
		  <div class="dial" style="--p:35" th:style="'--p:' + ${user.expPercent}">
		    <svg viewBox="0 0 200 120" aria-label="レベルメーター">
		      <!-- 半円枠 -->
		      <path d="M10,110 A90,90 0 0 1 190,110" class="arc"></path>

			  <!-- 目盛り（アーチに沿う放射状） -->
			  <g class="ticks">
			    <!-- 円の半径 R=90。アーチ近くに短い線（y=24〜36）を置いて回転させる -->
			    <g transform="rotate(-75 100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(-60 100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(-45 100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(-30 100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(-15 100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(0   100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(15  100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(30  100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(45  100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(60  100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			    <g transform="rotate(75  100 110)"><line x1="100" y1="24" x2="100" y2="36"/></g>
			  </g>


		      <!-- 針（中心で回転） -->
		      <g class="needle">
		        <line x1="100" y1="110" x2="100" y2="36"/>
		        <circle cx="100" cy="110" r="6"/>
		      </g>
		    </svg>
		  </div>
		</aside>
		
		<a class="btn small diagnose-btn" th:href="@{/diagnose}" href="/diagnose">診断する</a>

		<!-- 右上ハンバーガー -->
		<details class="hamburger at-tr" aria-label="メニュー">
		  <summary class="hambtn" aria-label="メニューを開く">
		    <span class="bars" aria-hidden="true"></span>
		  </summary>

		  <!-- ここが“真下に”展開される -->
		  <nav class="list">
		    <a href="/stats">📊 記録</a>
		    <a href="/profile">🪪 キャラクター詳細</a>
			<a href="/trophy">🏆 称号・アイテム一覧</a>
		    <a href="/settings">⚙️ 設定</a>
		  </nav>
		</details>
		
      </section>

      <div class="meta">
        <span>v0.1.0</span>
      </div>
    </div>
  </main>

  <script>
    // ============ ボタンの波紋位置をカーソルに合わせる
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('pointerdown', e => {
        const rect = btn.getBoundingClientRect();
        btn.style.setProperty('--mx', `${e.clientX - rect.left}px`);
        btn.style.setProperty('--my', `${e.clientY - rect.top}px`);
      });
    });

    // ============ わずかなパララックス(背景全体)
    const stage = document.querySelector('.stage');
    const strength = 8; // px
    let rafId = null;
    function onMove(e){
      const x = (e.clientX / window.innerWidth - 0.5) * strength;
      const y = (e.clientY / window.innerHeight - 0.5) * strength;
      if(rafId) cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(() => {
        stage.style.backgroundPosition = `calc(50% + ${x}px) 80px, center`;
      });
    }
    window.addEventListener('pointermove', onMove);

    // ============ 実装時のナビゲーション置き換えフック
    document.getElementById('startBtn').addEventListener('click', (e) => {
      // TODO: ここをフロントルーター遷移 or 通常のリンク先に置換
      // 例) location.href = '/play';
      // 今はデモなのでアンカーのまま
    });
      // レベルゲージ初期化（data-p を width に反映してアニメ開始）
    document.querySelectorAll('.levelbar .bar span').forEach(sp =>{
      const p = sp.getAttribute('data-p') || 0;
      sp.style.setProperty('--p', p + '%');
      sp.classList.add('gain');
    });
  </script>
</body>
</html>
